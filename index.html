
<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  
  <title>BLOG - Blackskygg&#39;s LOG</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta name="description" content="Blackskygg&apos;s LOG">
<meta property="og:type" content="website">
<meta property="og:title" content="BLOG - Blackskygg's LOG">
<meta property="og:url" content="https://blackskygg.github.io/index.html">
<meta property="og:site_name" content="BLOG - Blackskygg's LOG">
<meta property="og:description" content="Blackskygg&apos;s LOG">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="BLOG - Blackskygg's LOG">
<meta name="twitter:description" content="Blackskygg&apos;s LOG">
<meta name="twitter:creator" content="@blackskygg">
<link rel="publisher" href="blackskygg@gmail.com">
  
  
    <link rel="icon" href="/favicon.png">
  
  <link rel="stylesheet" href="/css/style.css">
  <!--[if lt IE 9]><script src="//cdnjs.cloudflare.com/ajax/libs/html5shiv/3.7/html5shiv.min.js"></script><![endif]-->
  
</head>
<body>
<div id="container">
  <div id="wrap">
    <header id="header">
  <div id="banner"></div>
  <div id="header-outer" class="outer">
    <div id="header-title" class="inner">
      <h1 id="logo-wrap">
        <a href="/" id="logo">BLOG - Blackskygg&#39;s LOG</a>
      </h1>
      
        <h2 id="subtitle-wrap">
          <a href="/" id="subtitle">Blackskygg&#39;s LOG</a>
        </h2>
      
    </div>
    <div id="header-inner" class="inner">
      <nav id="main-nav">
        <a id="main-nav-toggle" class="nav-icon"></a>
        
          <a class="main-nav-link" href="/">Home</a>
        
          <a class="main-nav-link" href="/archives">Archives</a>
        
      </nav>
      <nav id="sub-nav">
        
        <a id="nav-search-btn" class="nav-icon" title="Search"></a>
      </nav>
      <div id="search-form-wrap">
        <form action="https://www.baidu.com/baidu" method="get" accept-charset="utf-8" class="search-form">
          <input type="search" name="word" maxlength="20" class="search-form-input" placeholder="Search">
          <input type="submit" value="" class="search-form-submit">
          <input name=tn type=hidden value="bds">
          <input name=cl type=hidden value="3">
          <input name=ct type=hidden value="2097152">
          <input type="hidden" name="si" value="blackskygg.github.io">
        </form>
      </div>
    </div>
  </div>
</header>
    <div class="outer">
      <section id="main">
  
    <article id="post-Fabric源码分析-从peer命令行参数到Transaction对象" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2017/02/28/Fabric源码分析-从peer命令行参数到Transaction对象/" class="article-date">
  <time datetime="2017-02-28T14:19:55.000Z" itemprop="datePublished">2017-02-28</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2017/02/28/Fabric源码分析-从peer命令行参数到Transaction对象/">从peer命令行参数到Transaction对象</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>以Invoke Transaction的构造为例. 分析基于v6.0版本的代码.</p>
<h2 id="构造一个Transaction对象的流程"><a href="#构造一个Transaction对象的流程" class="headerlink" title="构造一个Transaction对象的流程"></a>构造一个Transaction对象的流程</h2><p><code>Transaction</code>对象定义在<code>fabric/protos/fabric.pb.go</code>中，代码如下：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div></pre></td><td class="code"><pre><div class="line">type Transaction struct &#123;</div><div class="line">	Type Transaction_Type `protobuf:&quot;varint,1,opt,name=type,enum=protos.Transaction_Type&quot; json:&quot;type,omitempty&quot;`</div><div class="line">	// store ChaincodeID as bytes so its encrypted value can be stored</div><div class="line">	ChaincodeID                    []byte                     `protobuf:&quot;bytes,2,opt,name=chaincodeID,proto3&quot; json:&quot;chaincodeID,omitempty&quot;`</div><div class="line">	Payload                        []byte                     `protobuf:&quot;bytes,3,opt,name=payload,proto3&quot; json:&quot;payload,omitempty&quot;`</div><div class="line">	Metadata                       []byte                     `protobuf:&quot;bytes,4,opt,name=metadata,proto3&quot; json:&quot;metadata,omitempty&quot;`</div><div class="line">	Txid                           string                     `protobuf:&quot;bytes,5,opt,name=txid&quot; json:&quot;txid,omitempty&quot;`</div><div class="line">	Timestamp                      *google_protobuf.Timestamp `protobuf:&quot;bytes,6,opt,name=timestamp&quot; json:&quot;timestamp,omitempty&quot;`</div><div class="line">	ConfidentialityLevel           ConfidentialityLevel       `protobuf:&quot;varint,7,opt,name=confidentialityLevel,enum=protos.ConfidentialityLevel&quot; json:&quot;confidentialityLevel,omitempty&quot;`</div><div class="line">	ConfidentialityProtocolVersion string                     `protobuf:&quot;bytes,8,opt,name=confidentialityProtocolVersion&quot; json:&quot;confidentialityProtocolVersion,omitempty&quot;`</div><div class="line">	Nonce                          []byte                     `protobuf:&quot;bytes,9,opt,name=nonce,proto3&quot; json:&quot;nonce,omitempty&quot;`</div><div class="line">	ToValidators                   []byte                     `protobuf:&quot;bytes,10,opt,name=toValidators,proto3&quot; json:&quot;toValidators,omitempty&quot;`</div><div class="line">	Cert                           []byte                     `protobuf:&quot;bytes,11,opt,name=cert,proto3&quot; json:&quot;cert,omitempty&quot;`</div><div class="line">	Signature                      []byte                     `protobuf:&quot;bytes,12,opt,name=signature,proto3&quot; json:&quot;signature,omitempty&quot;`</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>构造一个Transcation对象的关键在于如何填充Payload字段. 对于Type为Invoke的Transaction来说, Payload字段是一个Marshal过的<code>ChaincodeInvationSpec</code>对象, 该对象在<code>fabric/protos/chaincode.pb.go</code>中定义, 代码如下:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line">type ChaincodeInvocationSpec struct &#123;</div><div class="line">	ChaincodeSpec *ChaincodeSpec `protobuf:&quot;bytes,1,opt,name=chaincodeSpec&quot; json:&quot;chaincodeSpec,omitempty&quot;`</div><div class="line">	// This field can contain a user-specified ID generation algorithm</div><div class="line">	// If supplied, this will be used to generate a ID</div><div class="line">	// If not supplied (left empty), sha256base64 will be used</div><div class="line">	// The algorithm consists of two parts:</div><div class="line">	//  1, a hash function</div><div class="line">	//  2, a decoding used to decode user (string) input to bytes</div><div class="line">	// Currently, SHA256 with BASE64 is supported (e.g. idGenerationAlg=&apos;sha256base64&apos;)</div><div class="line">	IdGenerationAlg string `protobuf:&quot;bytes,2,opt,name=idGenerationAlg&quot; json:&quot;idGenerationAlg,omitempty&quot;`</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>里面的ChaincodeSpec在同一个文件下面:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line">type ChaincodeSpec struct &#123;</div><div class="line">	Type                 ChaincodeSpec_Type   `protobuf:&quot;varint,1,opt,name=type,enum=protos.ChaincodeSpec_Type&quot; json:&quot;type,omitempty&quot;`</div><div class="line">	ChaincodeID          *ChaincodeID         `protobuf:&quot;bytes,2,opt,name=chaincodeID&quot; json:&quot;chaincodeID,omitempty&quot;`</div><div class="line">	CtorMsg              *ChaincodeInput      `protobuf:&quot;bytes,3,opt,name=ctorMsg&quot; json:&quot;ctorMsg,omitempty&quot;`</div><div class="line">	Timeout              int32                `protobuf:&quot;varint,4,opt,name=timeout&quot; json:&quot;timeout,omitempty&quot;`</div><div class="line">	SecureContext        string               `protobuf:&quot;bytes,5,opt,name=secureContext&quot; json:&quot;secureContext,omitempty&quot;`</div><div class="line">	ConfidentialityLevel ConfidentialityLevel `protobuf:&quot;varint,6,opt,name=confidentialityLevel,enum=protos.ConfidentialityLevel&quot; json:&quot;confidentialityLevel,omitempty&quot;`</div><div class="line">	Metadata             []byte               `protobuf:&quot;bytes,7,opt,name=metadata,proto3&quot; json:&quot;metadata,omitempty&quot;`</div><div class="line">	Attributes           []string             `protobuf:&quot;bytes,8,rep,name=attributes&quot; json:&quot;attributes,omitempty&quot;`</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>其中最核心的字段为<code>CTorMsg</code>和<code>ChaincodeId</code>. ChiancodeId为chaincode的路径，CTorMsg是一个指向ChaincodeInput对象的指针, 而ChiancodeInput就是调用Chaincode时指定的函数名以及参数.</p>
<p>因此构造一个Invoke类型的Transaction的关键步骤为:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">CTorMsg, ChaincodeID==&gt;ChaincodeSpec==&gt;ChaincodeInvocationSpec==&gt;Transaction</div></pre></td></tr></table></figure>
<h2 id="peer客户端是如何把命令行参数构造成相应Transaction对象的"><a href="#peer客户端是如何把命令行参数构造成相应Transaction对象的" class="headerlink" title="peer客户端是如何把命令行参数构造成相应Transaction对象的"></a>peer客户端是如何把命令行参数构造成相应Transaction对象的</h2><p>peer使用了cobra框架, 对应chaincode子命令的相应定义在<code>fabric/peer/chaincode/chaincode.go</code>. 通过分析发现与invoke操作挂钩的是<code>fabric/peer/chaincode/invoke.go</code>里面的<code>chaincodeInvoke</code>, 而这个函数又转而直接调用了<code>fabric/peer/chaincode/common.go</code>里的<code>chaincodeInvokeOrQuery</code>. 关键的部分从这里开始.</p>
<p>函数先是调用了<code>getChaincodeSpecification</code>来构造一个<code>ChaincodeSpec</code>.<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">spec, err := getChaincodeSpecification(cmd)</div></pre></td></tr></table></figure></p>
<p>跟到<code>getChaincodeSpecification</code>里, 可以看到在这里<code>ChaincodeSpec</code>是如何被填充的:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div></pre></td><td class="code"><pre><div class="line">spec := &amp;pb.ChaincodeSpec&#123;&#125;</div><div class="line">if err := checkChaincodeCmdParams(cmd); err != nil &#123;</div><div class="line">	return spec, err</div><div class="line">&#125;</div><div class="line"></div><div class="line">// Build the spec</div><div class="line">input := &amp;pb.ChaincodeInput&#123;&#125;</div><div class="line">if err := json.Unmarshal([]byte(chaincodeCtorJSON), &amp;input); err != nil &#123;</div><div class="line">	return spec, fmt.Errorf(&quot;Chaincode argument error: %s&quot;, err)</div><div class="line">&#125;</div><div class="line"></div><div class="line">var attributes []string</div><div class="line">if err := json.Unmarshal([]byte(chaincodeAttributesJSON), &amp;attributes); err != nil &#123;</div><div class="line">	return spec, fmt.Errorf(&quot;Chaincode argument error: %s&quot;, err)</div><div class="line">&#125;</div><div class="line"></div><div class="line">chaincodeLang = strings.ToUpper(chaincodeLang)</div><div class="line">spec = &amp;pb.ChaincodeSpec&#123;</div><div class="line">	Type:        pb.ChaincodeSpec_Type(pb.ChaincodeSpec_Type_value[chaincodeLang]),</div><div class="line">	ChaincodeID: &amp;pb.ChaincodeID&#123;Path: chaincodePath, Name: chaincodeName&#125;,</div><div class="line">	CtorMsg:     input,</div><div class="line">	Attributes:  attributes,</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>其中的<code>chaincodeCtorJSON</code>等变量就是从命令行传入的JSON格式的参数, 这个函数把这些参数Unmarshal之后填入了目标chaincodeSpec中.</p>
<p>得到<code>chaincodeSpec</code>之后,回到<code>chaincodeInvokeOrQuery</code>,可以看到这个<code>chaincodeSpec</code>被用以勾造了一个<code>ChaincodeInvocationSpec</code>:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">invocation := &amp;pb.ChaincodeInvocationSpec&#123;ChaincodeSpec: spec&#125;</div></pre></td></tr></table></figure>
<p>按照上一节说的构造顺序, 接下来只要把这个<code>ChaincodeInvocationSpec</code>给marshal了然后扔进一个<code>Transaction</code>里就大功告成了. 而这个动作是在<code>fabric/core/devops.go</code>的<code>createExecTx</code>函数中完成的(这里实际上省略了很长一段调用链的分析, 大概流程为: grpc调用invoke方法-&gt;invoke_handler-&gt;devopsServer.invoke-&gt;createExecTx).</p>
<p>到了<code>createExecTx</code>思路实际上就很清晰了, 里面有关键性的一行:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">tx, err = pb.NewChaincodeExecute(spec, uuid, t)</div></pre></td></tr></table></figure>
<p>其中uuid是用<code>util.GenerateIdWithAlg</code>由spec中的<code>CtorMsg</code>算出来的, t就是Transaction类型.也就是说, <code>pb.NewChaincodeExecute</code>完成了最终的Transaction组装.它位于<code>fabridc/protos/transaction.go</code>, 代码如下:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div></pre></td><td class="code"><pre><div class="line">func NewChaincodeExecute(chaincodeInvocationSpec *ChaincodeInvocationSpec, uuid string, typ Transaction_Type) (*Transaction, error) &#123;</div><div class="line">	transaction := new(Transaction)</div><div class="line">	transaction.Type = typ</div><div class="line">	transaction.Txid = uuid</div><div class="line">	transaction.Timestamp = util.CreateUtcTimestamp()</div><div class="line">	cID := chaincodeInvocationSpec.ChaincodeSpec.GetChaincodeID()</div><div class="line">	if cID != nil &#123;</div><div class="line">		data, err := proto.Marshal(cID)</div><div class="line">		if err != nil &#123;</div><div class="line">			return nil, fmt.Errorf(&quot;Could not marshal chaincode : %s&quot;, err)</div><div class="line">		&#125;</div><div class="line">		transaction.ChaincodeID = data</div><div class="line">	&#125;</div><div class="line">	data, err := proto.Marshal(chaincodeInvocationSpec)</div><div class="line">	if err != nil &#123;</div><div class="line">		return nil, fmt.Errorf(&quot;Could not marshal payload for chaincode invocation: %s&quot;, err)</div><div class="line">	&#125;</div><div class="line">	transaction.Payload = data</div><div class="line">	return transaction, nil</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>至此, 整个流程完成.</p>

      
    </div>
    <footer class="article-footer">
      
        <a data-url="https://blackskygg.github.io/2017/02/28/Fabric源码分析-从peer命令行参数到Transaction对象/" data-id="cizpmqeis0000npnioa458x4a" class="article-share-link" data-share="baidu">Share</a>
      

      
        <a href="https://blackskygg.github.io/2017/02/28/Fabric源码分析-从peer命令行参数到Transaction对象/#ds-thread" class="article-comment-link">Comments</a>
      

      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/BlockChain/">BlockChain</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/hypderldger-fabric/">hypderldger/fabric</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-whosdatingwho-crawler" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2016/08/25/whosdatingwho-crawler/" class="article-date">
  <time datetime="2016-08-25T07:52:26.000Z" itemprop="datePublished">2016-08-25</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2016/08/25/whosdatingwho-crawler/">写个爬虫爬好莱坞八卦新闻</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>这篇文章提到的源码可以在我的github<a href="https://github.com/blackskygg/whosdatedwho_crawler" target="_blank" rel="external">^0</a>上面找到, 项目名称是whosdatedwho_crawler.</p>
<h2 id="这篇东西是什么鬼"><a href="#这篇东西是什么鬼" class="headerlink" title="这篇东西是什么鬼"></a>这篇东西是什么鬼</h2><hr>
<p>以下是废话.<br>所有东西的存在都是有原因的. 就算你是在发呆, 也有“我什么事情都不想干”这个原因. 而之所以会有这篇文章, 全都是因为我太懒了.<br>学校有一门奇怪的课程叫思政课社会实践, 说白了就是社会调查. 很多人都可以周期性的感知到这门课的存在, 因为每隔一段时间在你的qq聊天列表的某个群里就会蹦出来一个“社会调查问卷, 帮忙填一下, 谢谢！！！”, 而且后面一定会跟着一个红包. 但是我是懒的, 而且我也很穷. 不可能会去设计这么一份问卷然后一个一个群用红包去拜托别人. 但是作业还是要做的. 且我的良心不允许我作假. 于是, 我就希望能找到这样一个调查课题, 它所需的信息可以很方便的获取到. 而这个时候, 刚好某老实巴交的男演员被人绿了, 而且他一被绿全中国都知道了, 这让我得到了一个结论：</p>
<blockquote>
<p>名人的婚恋八卦是互联网上最不缺乏的资源. </p>
</blockquote>
<p>于是, 我想起了一个神奇的网站www.whosdatedwho.com<a href="http://www.whosdatedwho.com/" target="_blank" rel="external">^1</a>, 这上面收录了大量（大概翻了一下, 发现深不见底, 一直到19世纪60年代的记录都有）好莱坞明星（其实也不限好莱坞, 比如秦凯跟何姿的engagement上面也有记录）的恋爱, 分手, 订婚, 结婚和生小孩的信息, 而且过半数的条目里面都会有关于这对couple的各种信息对比, 包括括国籍, 身高, 职业, 年龄等, 可以说是丰富的八卦来源. 于是, 我便开始着手编写爬虫, 把上面的数据爬下来. 有了这玩意, 就可以研究诸如”身高差对好莱坞明星恋情长度的关系”, “年龄差对好莱坞明星恋情长度的关系”之类的问题了.<br>这篇文章记录了寻找whosdatedwho.com的记录查询接口, 分析网页结构, 数据表设计以及构建爬虫的过程.<br>废话到此结束. </p>
<h2 id="寻找whosdatedwho-com的记录查询接口"><a href="#寻找whosdatedwho-com的记录查询接口" class="headerlink" title="寻找whosdatedwho.com的记录查询接口"></a>寻找whosdatedwho.com的记录查询接口</h2><hr>
<p>我们爬一个网站的时候, 并不是乱爬的, 理想的情况是：这个网站有一个可翻页的列表, 翻页可以通过改变url中的page之类的参数来控制, 每一页有固定数目的通向详情页面的链接. 这样的话, 我们的爬虫就只需要一页一页地把详情页面的链接抠出来, 然后再跟着这些链接进入到详情页面去爬取需要的信息.<br>在whosdatedwho的首页中间可以看到一个大大的”Latest Events”, 旁边跟着一个小小的”See More”. 直觉告诉我们这个see more里面会有我们想要得东西. 进去之后发现到了<a href="http://www.whosdatedwho.com/timeline" target="_blank" rel="external">http://www.whosdatedwho.com/timeline</a>, 而这里的确有一个列表, 但是是下拉加载更多的那种. 这个下拉加载更多的玩意儿对于爬虫来说并没有什么用处, 除非我在爬虫里面加上js解释器, 然后再向页面发送模拟的下拉信息, 不过这样太洒了, 我不打算这样做. 我们知道, 凡是这种东西肯定是用ajax或者websocket做出来的, 所以我们只要分析一下源码找到相应的数据获取接口就行了. 逛了了一圈发现这个无限延长的列表在`#ff-7c01f37bfcc5c8dc3e81f5359fd5b212 &gt; div.ff &gt; div.ff-latest-list, 于是我在这个节点上加了一个on subtree modifications断点, 然后下拉, 发现代码停在这样一个地方：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">append: function() &#123;</div><div class="line">	return this.domManip(arguments, function(a) &#123;</div><div class="line">		if (1 === this.nodeType || 11 === this.nodeType || 9 === this.nodeType) &#123;</div><div class="line">			var b = m(this, a);</div><div class="line">=&gt;          b.appendChild(a)</div><div class="line">		&#125;</div><div class="line">	&#125;)</div></pre></td></tr></table></figure>
<p>调用栈如下:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div></pre></td><td class="code"><pre><div class="line">(anonymous function) (js?f=/dev/zurb/…formatted:2589)</div><div class="line">domManip (js?f=/dev/zurb/…formatted:2681)</div><div class="line">append (js?f=/dev/zurb/…formatted:2586)</div><div class="line">_.fn.(anonymous function) (js?f=/dev/zurb/…formatted:2702)</div><div class="line">opts.loading.start (js?f=/static/jq…js,sly.js…:272)</div><div class="line">infscr_retrieve (js?f=/static/jq…js,sly.js…:305)</div><div class="line">infscr_scroll (js?f=/static/jq…js,sly.js…:308)</div><div class="line">(anonymous function) (js?f=/static/jq…js,sly.js…:268)</div><div class="line">dispatch (js?f=/dev/zurb/…formatted:2251)</div><div class="line">q.handle (js?f=/dev/zurb/…formatted:2143)</div><div class="line">trigger (js?f=/dev/zurb/…formatted:2225)</div><div class="line">(anonymous function) (js?f=/dev/zurb/…formatted:2487)</div><div class="line">each (js?f=/dev/zurb/…:formatted:622)</div><div class="line">each (js?f=/dev/zurb/…:formatted:521)</div><div class="line">trigger (js?f=/dev/zurb/…formatted:2486)</div><div class="line">(anonymous function) (js?f=/static/jq…js,sly.js…:312)</div></pre></td></tr></table></figure>
<p>看了以下变量a的值, 发现这是一个img节点, 图像内容是一个圈圈, 看来是下拉的时候出现的那个表示“加载中”的圈圈. 这不是我们想要的, 于是我们让它继续执行. 很快, 代码又停在了同样的地方, 但是此时调用栈已经变成了这样:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div></pre></td><td class="code"><pre><div class="line">(anonymous function) (js?f=/dev/zurb/…formatted:2589)</div><div class="line">domManip (js?f=/dev/zurb/…formatted:2681)</div><div class="line">append (js?f=/dev/zurb/…formatted:2586)</div><div class="line">_.fn.(anonymous function) (js?f=/dev/zurb/…formatted:2702)</div><div class="line">(anonymous function) (js?f=/static/jq…js,sly.js…:639)</div><div class="line">each (js?f=/dev/zurb/…:formatted:622)</div><div class="line">each (js?f=/dev/zurb/…:formatted:521)</div><div class="line">update (js?f=/static/jq…js,sly.js…:639)</div><div class="line">(anonymous function) (js?f=/static/jq…5.js,sly.js…:1)</div><div class="line">opts.callback (js?f=/static/jq…js,sly.js…:274)</div><div class="line">infscr_loadcallback (js?f=/static/jq…js,sly.js…:294)</div><div class="line">infscr_ajax_callback (js?f=/static/jq…js,sly.js…:303)</div><div class="line">k (js?f=/dev/zurb/…formatted:1720)</div><div class="line">fireWith (js?f=/dev/zurb/…formatted:1777)</div><div class="line">c (js?f=/dev/zurb/…formatted:3482)</div><div class="line">(anonymous function) (js?f=/dev/zurb/…formatted:3744)</div></pre></td></tr></table></figure>
<p>ajax四个大字映入眼帘. 进到到infscr_ajax_callback, 发现代码停在这个地方：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div></pre></td><td class="code"><pre><div class="line">case &apos;html&apos;:</div><div class="line">	instance._debug(&apos;Using &apos; + (method.toUpperCase()) + &apos; via $.ajax() method&apos;);</div><div class="line">	$.ajax(&#123;</div><div class="line">		url: desturl,</div><div class="line">		dataType: opts.dataType,</div><div class="line">		complete: function infscr_ajax_callback(jqXHR, textStatus) &#123;</div><div class="line">			condition = (typeof (jqXHR.isResolved) !== &apos;undefined&apos;) ? (jqXHR.isResolved()) : (textStatus === &apos;success&apos; || textStatus === &apos;notmodified&apos;);</div><div class="line">			if (condition) &#123;</div><div class="line">=&gt;				instance._loadcallback(box, jqXHR.responseText, desturl)</div><div class="line">			&#125; else &#123;</div><div class="line">				instance._error(&apos;end&apos;)</div><div class="line">			&#125;</div><div class="line">		&#125;</div><div class="line">	&#125;);</div><div class="line">	break;</div></pre></td></tr></table></figure>
<p>看来就是这里没跑了. 查看desturl的值, 发现是<code>?page=2&amp;_block=page.latestEvents</code>. 也就是说, 这个page=2就是翻页的关键. 于是我把2改成3试了一下, 发现可以正常加载新的内容. (我也尝试过把<code>&amp;_block=page.latestEvents</code>去掉, 不过发现去掉之后不能正常工作.)<br>于是, 们得到了想要的东西：</p>
<blockquote>
<p>第$k$页记录的url为: <a href="http://www.whosdatedwho.com/timeline?page=$k$&amp;_block=page.latestEvents" target="_blank" rel="external">http://www.whosdatedwho.com/timeline?page=$k$&amp;_block=page.latestEvents</a></p>
</blockquote>
<h2 id="设计数据表"><a href="#设计数据表" class="headerlink" title="设计数据表"></a>设计数据表</h2><hr>
<p>在确认了数据能够抓取之后, 在确定下一步抓取计划之前, 需要确定你要抓取些什么, 以及在何处抓取. 通过观察, 可以发现列表页面有的信息为:</p>
<ul>
<li>事件类型, 包括: Hookup, Breakup, Engagement, Marriage, Child, Divorce</li>
<li>日期</li>
<li>双方姓名</li>
<li>进入到详情页面的链接</li>
</ul>
<p>随便进入到一个详情页面, 发现里面能够提供的信息有：</p>
<ul>
<li>姓名</li>
<li>年龄</li>
<li>身高</li>
<li>星座</li>
<li>职业</li>
<li>发色</li>
<li>瞳色</li>
<li>国籍</li>
<li>匹配度</li>
<li>是否事实</li>
<li>持续时间</li>
</ul>
<p>数据用传统的关系型数据库存储, 可以设计如下数据表：</p>
<pre><code>whosdatedwho
+--------------+-------------+------+-----+---------+-------+
| Field        | Type        | Null | Key | Default | Extra |
+--------------+-------------+------+-----+---------+-------+
| name1        | varchar(64) | YES  |     | NULL    |       |
| name2        | varchar(64) | YES  |     | NULL    |       |
| gender1      | varchar(8)  | YES  |     | NULL    |       |
| gender2      | varchar(8)  | YES  |     | NULL    |       |
| height1      | smallint(6) | YES  |     | NULL    |       |
| height2      | smallint(6) | YES  |     | NULL    |       |
| age1         | tinyint(4)  | YES  |     | NULL    |       |
| age2         | tinyint(4)  | YES  |     | NULL    |       |
| zodiac1      | varchar(16) | YES  |     | NULL    |       |
| zodiac2      | varchar(16) | YES  |     | NULL    |       |
| occupation1  | varchar(64) | YES  |     | NULL    |       |
| occupation2  | varchar(64) | YES  |     | NULL    |       |
| haircolor1   | varchar(32) | YES  |     | NULL    |       |
| haircolor2   | varchar(32) | YES  |     | NULL    |       |
| eyecolor1    | varchar(32) | YES  |     | NULL    |       |
| eyecolor2    | varchar(32) | YES  |     | NULL    |       |
| nationality1 | varchar(64) | YES  |     | NULL    |       |
| nationality2 | varchar(64) | YES  |     | NULL    |       |
| event        | varchar(64) | YES  |     | NULL    |       |
| date         | date        | YES  |     | NULL    |       |
| duration     | tinyint(4)  | YES  |     | NULL    |       |
| score        | tinyint(4)  | YES  |     | NULL    |       |
+--------------+-------------+------+-----+---------+-------+
</code></pre><p>相应的SQL语句为:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line">create table whosdatedwho (name1 varchar(64), name2 varchar(64), </div><div class="line">gender1 varchar(8), gender2 varchar(8), </div><div class="line">height1 smallint, height2 smallint, </div><div class="line">age1 tinyint, age2 tinyint, </div><div class="line">zodiac1 varchar(16), zodiac2 varchar(16), </div><div class="line">occupation1 varchar(64), occupation2 varchar(64), </div><div class="line">haircolor1 varchar(32), haircolor2 varchar(32), </div><div class="line">eyecolor1 varchar(32), eyecolor2 varchar(32), </div><div class="line">nationality1 varchar(64), nationality2 varchar(64), </div><div class="line">event varchar(64), date date, </div><div class="line">duration tinyint, score tinyint);</div></pre></td></tr></table></figure>
<h2 id="构建抓取xpath"><a href="#构建抓取xpath" class="headerlink" title="构建抓取xpath"></a>构建抓取xpath</h2><hr>
<p>我们采用xpath来定位信息承载节点, 这个东西纯粹是个体力活. 以详情页面中的couple comparison部分为例, 在<code>#ff-couple-comparison</code>中, 可以看到name相关的部分是这样的:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div></pre></td><td class="code"><pre><div class="line">...</div><div class="line">&lt;div class=&quot;row collapse&quot;&gt;</div><div class="line">	&lt;div style=&quot;color:#c6c6c6;&quot; class=&quot;small-12 columns text-center&quot;&gt;Name&lt;/div&gt;</div><div class="line">&lt;/div&gt;</div><div class="line">&lt;div class=&quot;row collapse&quot;&gt;</div><div class="line">	&lt;div style=&quot;padding-right:1rem;border-right:1px solid #d6d6d6;&quot; class=&quot;small-6 columns text-right&quot;&gt;</div><div class="line">		&lt;h5&gt;&lt;/h5&gt;</div><div class="line">		&lt;h5&gt; Cassie Ventura &lt;/h5&gt;</div><div class="line">	&lt;/div&gt;</div><div class="line">	&lt;div style=&quot;padding-left:1rem;border-left:1px solid #d6d6d6;&quot; class=&quot;small-6 columns text-left&quot;&gt;</div><div class="line">		&lt;h5&gt;&lt;/h5&gt;</div><div class="line">		&lt;h5&gt; Sean Combs &lt;/h5&gt;</div><div class="line">	&lt;/div&gt;</div><div class="line">&lt;/div&gt;</div><div class="line">...</div></pre></td></tr></table></figure>
<p>其结构特点为: 由一个担任标题作用的#row collapse引导出接下来的几个包含信息的#row collapse, 信息藏在一对h5标签之后. 虽然每个页面有的信息不尽相同, 但是我们可以通过遍历这些#row collapse来判断出现了哪些信息. 比如上面出现了Name, 就可以知道下一个#row collapse肯定包含了名字信息, 所以我就可以在下一个#row collapse中提取相关信息, 然后再从下下个#row collapse开始继续往下遍历, 直至遍历完这一系列#row collapse.<br>需要注意的一点是, couple comparison中男女出现的位置是是不一定的, 有时男的在左, 有时女的在左, 有时男的既在左又在右, 所以需要进行判断, 判断的方法是读取height一栏中图片的alt属性(Male or Female).<br>具体的xpath可以参见源码. </p>
<h2 id="构建爬虫"><a href="#构建爬虫" class="headerlink" title="构建爬虫"></a>构建爬虫</h2><hr>
<p>其实到了这一步基本上已经水到渠成了. 爬虫使用python+scrapy实现. 需要注意的一点是, 并不是每一个item都包含了所有的字段, 所以在向数据库插入数据时不能简单地用一个字符串模板来构建sql语句, 需要根据有的字段动态构建, 代码如下；</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div></pre></td><td class="code"><pre><div class="line">...</div><div class="line">field_list = []</div><div class="line">value_list = []</div><div class="line"></div><div class="line">for key in item:</div><div class="line">	field_list.append(key)</div><div class="line">	value = item.fields[key][&quot;serializer&quot;](item[key])</div><div class="line">	if isinstance(value, unicode):</div><div class="line">		value_list.append(cymysql.escape_string(value))</div><div class="line">	elif isinstance(value, int):</div><div class="line">		value_list.append(str(value))</div><div class="line"></div><div class="line">self.cur.execute(&quot;insert into whosdatedwho(%s) values(%s)&quot;%</div><div class="line">				 (&quot;,&quot;.join(field_list,</div><div class="line">				 &quot;,&quot;.join(value_list)))</div><div class="line">...</div></pre></td></tr></table></figure>
<p>还有就是要注意转义, 别自己把自己给注入了. </p>
<h2 id="实际爬取"><a href="#实际爬取" class="headerlink" title="实际爬取"></a>实际爬取</h2><hr>
<p>接下来只需要<code>crapy crawl whosdatedwho</code>就可以去找个阴凉的地方喝茶慢慢等了. 爬虫的速度还是很不错的, 睡了个午觉, 起来来玩了会儿手机, 就有了33330条记录, 从1995到2016, 对于这种过家家的作业而言, 这3万多条数据足够了. </p>

      
    </div>
    <footer class="article-footer">
      
        <a data-url="https://blackskygg.github.io/2016/08/25/whosdatingwho-crawler/" data-id="cizpmqejc0007npnip9gln7i5" class="article-share-link" data-share="baidu">Share</a>
      

      
        <a href="https://blackskygg.github.io/2016/08/25/whosdatingwho-crawler/#ds-thread" class="article-comment-link">Comments</a>
      

      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Toys/">Toys</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-rsa" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2016/08/18/rsa/" class="article-date">
  <time datetime="2016-08-18T09:57:30.000Z" itemprop="datePublished">2016-08-18</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2016/08/18/rsa/">21天精通RSA(误)</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>这个系列是MIT Open Courseware Mathematics for Computer Science<a href="http://ocw.mit.edu/courses/electrical-engineering-and-computer-science/6-042j-mathematics-for-computer-science-fall-2010/" target="_blank" rel="external">^1</a>的记录</p>
<h2 id="同余"><a href="#同余" class="headerlink" title="同余"></a>同余</h2><p>a与b模n同余, 记作$a \equiv b(mod \space n)$, 如同字面上的意思, 它表示$rem(a, n) = rem(b, n)$. 等价地, 它还表示$n|(a-b)$.<br>考察$a = kn + rem(a, n)$, 发现$n|rem(a, n)-a$, 那么就有：</p>
<blockquote>
<ol>
<li>$a \equiv rem(a, n)(mod \space n)$</li>
</ol>
</blockquote>
<p>同余关系是等价关系, 因此自反, 传递且对称. 除此之外, 以下性质值得注意: </p>
<blockquote>
<ol>
<li>$a \equiv b (mod \space n)\implies a+c \equiv b+c(mod \space n)$</li>
<li>$a \equiv b (mod \space n)\implies ac \equiv bc(mod \space n)$</li>
<li>$a \equiv b (mod \space n) \land c \equiv d (mod \space n) \implies a+b \equiv c+d(mod \space n)$</li>
<li>$a \equiv b (mod \space n) \land c \equiv d (mod \space n) \implies ac \equiv bd(mod \space n)$</li>
</ol>
</blockquote>
<p>这里只是证明一下4, 而3的证明类似, 其余的比较明显. </p>
<blockquote>
<p>$a \equiv b (mod \space n) \implies ac \equiv bc(mod \space n)$<br>$c \equiv d (mod \space n) \implies bc \equiv bd(mod \space n)$<br>$由传递性, ac \equiv bd(mod \space n)$</p>
</blockquote>
<p>事实上, 在我瞎折腾的过程中, 发现由传递性还可以得到另一个有趣的结果. 如果p, q互质, 那么有$tp \equiv 1(mod \space q)$, 此时如果有另一个数r满足$(r \equiv p(mod \space q)$的话, 由于$(tr \equiv tp(mod \space q)$, 故$tr \equiv 1(mod \space q)$, 也就是r, q互质.<br>也就是说. 如果p, q互质, 且r与p模q同余, 则, r与q也互质. </p>
<p>这里只有$+-\times$, 但是却没有$/$. 考察$ka \equiv kb(mod \space n)$, 什么情况下能够把k从两边消掉呢.<br>之前说过$a \equiv b(mod \space n) \iff  n|(a-b)$, 那么也有$ka \equiv kb(mod \space n) \iff  n|k(a-b)$.<br>也就是说只要能保证$n|k(a-b) \implies n|(a-b)$就能保证$ka \equiv kb(mod \space n) \implies a \equiv b(mod \space n)$.<br>那么有一点是肯定的, 那就是n和k如果互质(relatively prime)的话, 那么必然满足上述条件, 当然也存在其它满足的情况, 有兴趣的可以深究, 但是现在我们只要知道以下事实就够了. </p>
<blockquote>
<ol>
<li>$如果a, b互质, 有ka \equiv kb(mod \space n) \implies a \equiv b(mod \space n)$</li>
</ol>
</blockquote>
<p>前一篇文章<a href="/2016/08/17/x86-mem-virtualization/">^2</a>曾经说过, gcd(a, b)实际上是a和b的最小线性组合. 而a, b互质又可以写成gcd(a, b)=1, 亦即$\exists t, a, 使得ta+sb=1$, 也就是说$ta \equiv 1(mod \space b)$.<br>我们定义t为a在mod b条件下的乘法逆元. 如此一来, 我们就有: </p>
<blockquote>
<ol>
<li>$如果a, n互质, 则存在a在mod \space n条件下的乘法逆元$</li>
</ol>
</blockquote>
<h2 id="欧拉函数"><a href="#欧拉函数" class="headerlink" title="欧拉函数"></a>欧拉函数</h2><p>介绍完同余, 来看看欧拉函数.<br>欧拉函数$\phi(n)$定义为小于n且于n互质的数的个数.<br>对于质数p, 显然有$\phi(p)=p-1$.<br>然后再来考察一堆互质的数p, q, 令r=pq. 定义比n小且与n互质的数的集合为Zn.<br>由p, q互质可知, 对于任意的一个$k \in Zr$, 都存在$ap + bq=k(mod \space r)$, 而且在mod r的语境下可以将a调整在(0, q), b调整到(0, p). 显然满足上述区间的a, b唯一(考虑$(a+mq)p+(b-mq-tq)p=k$), 而且a跟q互质, b跟p互质(否则与$k \in Zr$矛盾), 亦即$a \in Zq \land b \in Zp$. 于是有一个从$Zr$到$Zq \times Zp$的双射, 于是$\phi(pq) = \phi(p) \times \phi(q)$. 特别地, 如果p, q都是质数, 则$\phi(pq) = (p-1)(q-1)$. (事实上, 还可以用中国余剩定理反过来建立映射, 也可以证明).<br>由于合数可以唯一地表示为质数幂的乘积(算术基本定理), 一个自然的想法是研究质数幂的计算方法, 这样就可以构造出任意欧拉函数的计算方法了.<br>考察质数的幂$p^k$, 由于比p小且与p不互质的数有$(p, 2p, \space \cdots \space, (p^{k-1}-1)p)$共$p^{k-1}$个, 于是$\phi(p^{k})=p^k-p^{k-1}$.<br>那么就得到任何数的欧拉函数计算方法: </p>
<blockquote>
<ol>
<li>$\phi(n)=n\times\prod\limits_{p_i \in n的质因数} (1- \frac{1}{p_i})$</li>
</ol>
</blockquote>
<p>(其实推了那么多对于RSA并没有什么卵用, 只是推着玩玩, 真正有用的只有”如果p, q都是质数, 则$\phi(pq) = (p-1)(q-1)$”这一句)</p>
<h3 id="费马小定理"><a href="#费马小定理" class="headerlink" title="费马小定理"></a>费马小定理</h3><p>介绍欧拉函数之后之后, 就可以开始介绍费马小定理了. 费马小定理是这样说的: </p>
<blockquote>
<p>$gcd(p, n)=1 \implies p^{\phi(n)} \equiv 1(mod \space n)$</p>
</blockquote>
<p>这看起来就有点吓人了, 但其实有了前面的铺垫, 证明起来还是很简单的. 首先来证明一个小结论.<br>设比n小而且与n互质的数为$A={n_1, n_2, \space\cdots\space, n_r}$, 其中$r=\phi(n)$. 再构造一个数列$B={rem(pn_1, n), rem(pn_2, n), \space\cdots\space, rem(pn_r, n)}$. 显然有$(rem(pn_1, n) &lt; n-1) \land (gcd(rem(pn_1, n), n)=1) \land (B中元素两两不同)$.<br>综合这三个条件可以得出: B是A的一个全排列.<br>那么就有：</p>
<blockquote>
<p>$n_1 \cdot n_2 \cdots n_r$<br>$=rem(pn_1, n)\cdot rem(pn_2, n) \cdots rem(pn_r, n)$<br>$\equiv pn_1 \cdot \cdots \cdot pn_r$<br>$=p^{\phi(n)}\cdot n_1 \cdot n_2 \cdots n_r(mod \space n)$<br>$消去, 得1 \equiv p^{\phi(n)}(mod\space n)$</p>
</blockquote>
<h3 id="RSA"><a href="#RSA" class="headerlink" title="RSA"></a>RSA</h3><p>那么终于来到了最后一步, 也就是传说中的RSA. 我们先来给出RSA的加密解密步骤, 然后再来证明其正确性.<br>步骤是抄来的, 懒得翻译了. </p>
<blockquote>
<ol>
<li>Generate two distinct primes, p and q. Since they can be used to<br>generate the secret key, they must be kept hidden. </li>
<li>Let n = pq. </li>
<li>Select an integer e such that $gcd(ed, (p-1)(q-1)) = 1$.<br>The public key is the pair (e, n). This should be distributed widely. </li>
<li>Compute d such that $de \equiv 1(mod\space (p-1)(q-1)$. This can be done using the Pulverizer.<br>The secret key is the pair (d, n). This should be kept hidden!</li>
<li>Encoding: Given a message m, the sender first checks that gcd(m, n) = 1 The<br>sender then encrypts message m to produce m’ using the public key:<br>$m’ = rem(m^e, n)$</li>
<li>Decoding: The receiver decrypts message m’ back to message m using the secretkey:<br>$m = rem((m’)^d, n)$</li>
</ol>
</blockquote>
<p>因为m比n小, 所以要证明这一堆东西的正确性, 只需要证明$(m’)^d \equiv m(mod \space n)$.<br>有了前面的铺垫, 证明变得及其简单：</p>
<blockquote>
<p>$m’ = rem(m^e, n) \implies m’ \equiv m^e(mod\space n) \implies (m’)^d \equiv m^{ed}(mod\space n)$<br>$de \equiv 1(mod\space (p-1)(q-1) \implies de=1+r(p-1)(q-1)$<br>$所以, (m’)^d \equiv m\times m^{r(p-1)(q-1)}(mod\space n)$<br>$\implies (m’)^d \equiv m(mod \space n)$</p>
</blockquote>

      
    </div>
    <footer class="article-footer">
      
        <a data-url="https://blackskygg.github.io/2016/08/18/rsa/" data-id="cizpmqej40004npnirm0m7tck" class="article-share-link" data-share="baidu">Share</a>
      

      
        <a href="https://blackskygg.github.io/2016/08/18/rsa/#ds-thread" class="article-comment-link">Comments</a>
      

      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Mathematics-for-Computer-Science/">Mathematics for Computer Science</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Number-Theory/">Number Theory</a></li></ul>

    </footer>
  </div>
  
</article>


  
  
    <nav id="page-nav">
      <span class="page-number current">1</span><a class="page-number" href="/page/2/">2</a><a class="page-number" href="/page/3/">3</a><a class="extend next" rel="next" href="/page/2/">Next &raquo;</a>
    </nav>
  
</section>
      
      <aside id="sidebar">
  
    
  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Tags</h3>
    <div class="widget">
      <ul class="tag-list"><li class="tag-list-item"><a class="tag-list-link" href="/tags/BlockChain/">BlockChain</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Mathematics-for-Computer-Science/">Mathematics for Computer Science</a><span class="tag-list-count">2</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Number-Theory/">Number Theory</a><span class="tag-list-count">2</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Pieces/">Pieces</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Software-Security/">Software Security</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Toys/">Toys</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Virtualization/">Virtualization</a><span class="tag-list-count">2</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/hypderldger-fabric/">hypderldger/fabric</a><span class="tag-list-count">1</span></li></ul>
    </div>
  </div>

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Archives</h3>
    <div class="widget">
      <ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/02/">February 2017</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/08/">August 2016</a><span class="archive-list-count">6</span></li></ul>
    </div>
  </div>

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Recent Posts</h3>
    <div class="widget">
      <ul>
        
          <li>
            <a href="/2017/02/28/Fabric源码分析-从peer命令行参数到Transaction对象/">从peer命令行参数到Transaction对象</a>
          </li>
        
          <li>
            <a href="/2016/08/25/whosdatingwho-crawler/">写个爬虫爬好莱坞八卦新闻</a>
          </li>
        
          <li>
            <a href="/2016/08/18/rsa/">21天精通RSA(误)</a>
          </li>
        
          <li>
            <a href="/2016/08/17/x86-mem-virtualization/">x86内存虚拟化技术</a>
          </li>
        
          <li>
            <a href="/2016/08/17/virtio-host-guest-communication/">使用virtio-serial实现guest OS与host的高效通信</a>
          </li>
        
      </ul>
    </div>
  </div>

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Links</h3>
    <div class="widget">
      <ul>
        
          <li>
            <a href="https://github.com/blackskygg" target="_blank">blackskygg&#39;s github</a>
          </li>
        
          <li>
            <a href="http://xiguabaobao.com" target="_blank">主题作者</a>
          </li>
        
          <li>
            <a href="http://reqianduan.com" target="_blank">热前端</a>
          </li>
        
      </ul>
    </div>
  </div>

  
</aside>
      
    </div>
    <footer id="footer">
  
  <div class="outer">
    <div id="footer-info" class="inner">
      &copy; 2017 blacksygg<br>
      Powered by <a href="https://hexo.io/" target="_blank">Hexo</a>
      .
      Theme by <a href="https://github.com/xiangming/landscape-plus" target="_blank">Landscape-plus</a>
    </div>
  </div>
</footer>
  </div>
  <nav id="mobile-nav">
  
    <a href="/" class="mobile-nav-link">Home</a>
  
    <a href="/archives" class="mobile-nav-link">Archives</a>
  
</nav>
  <!-- totop start -->
<div id="totop">
<a title="totop"><img src="/img/scrollup.png"/></a>
</div>

<!-- totop end -->

<!-- 多说公共js代码 start -->
<script type="text/javascript">
var duoshuoQuery = {short_name:"blackskygg"};
  (function() {
    var ds = document.createElement('script');
    ds.type = 'text/javascript';ds.async = true;
    ds.src = (document.location.protocol == 'https:' ? 'https:' : 'http:') + '//static.duoshuo.com/embed.js';
    ds.charset = 'UTF-8';
    (document.getElementsByTagName('head')[0]
     || document.getElementsByTagName('body')[0]).appendChild(ds);
  })();
  </script>
<!-- 多说公共js代码 end -->


<!-- 百度分享 start -->

<div id="article-share-box" class="article-share-box">
  <div id="bdshare" class="bdsharebuttonbox article-share-links">
    <a class="article-share-weibo" data-cmd="tsina" title="分享到新浪微博"></a>
    <a class="article-share-weixin" data-cmd="weixin" title="分享到微信"></a>
    <a class="article-share-qq" data-cmd="sqq" title="分享到QQ"></a>
    <a class="article-share-renren" data-cmd="renren" title="分享到人人网"></a>
    <a class="article-share-more" data-cmd="more" title="更多"></a>
  </div>
</div>
<script>window._bd_share_config={"common":{},"share":{"bdCustomStyle":"/css/bdshare.css"}};with(document)0[(getElementsByTagName('head')[0]||body).appendChild(createElement('script')).src='https://bdimg.share.baidu.com/static/api/js/share.js?cdnversion='+~(-new Date()/36e5)];</script>

<!-- 百度分享 end -->

<script src="//cdnjs.cloudflare.com/ajax/libs/jquery/1.11.1/jquery.min.js"></script>


  <link rel="stylesheet" href="/fancybox/jquery.fancybox.css">
  <script src="/fancybox/jquery.fancybox.pack.js"></script>



<! -- mathjax config similar to math.stackexchange -->

<script type="text/x-mathjax-config">
MathJax.Hub.Config({
tex2jax: {
          inlineMath: [ ['$','$'], ["\\(","\\)"]  ],
                processEscapes: true
                    
}
  
        });
</script>

<script type="text/x-mathjax-config">
MathJax.Hub.Config({
tex2jax: {
            skipTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code']
                  
}
    
        });
</script>

<script type="text/x-mathjax-config">
MathJax.Hub.Queue(function() {
            var all = MathJax.Hub.getAllJax(), i;
            for(i=0; i < all.length; i += 1) {
                            all[i].SourceElement().parentNode.className += ' has-jax';
                                    
            }
                
        });
</script>

<script type="text/javascript" src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML">
</script>


<script src="/js/script.js"></script>

</div>
</body>
</html>
